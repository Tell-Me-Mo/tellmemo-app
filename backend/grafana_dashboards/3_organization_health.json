{
  "title": "\ud83c\udfe2 Organization Health",
  "tags": [
    "tellmemo",
    "organizations",
    "multi-tenant"
  ],
  "timezone": "browser",
  "refresh": "1m",
  "panels": [
    {
      "title": "Active Organizations",
      "type": "stat",
      "gridPos": {
        "x": 0,
        "y": 0,
        "w": 6,
        "h": 4
      },
      "description": "Number of organizations with activity",
      "targets": [
        {
          "expr": "count(sum by (organization_id) (business_organization_queries_total))",
          "refId": "A",
          "legendFormat": ""
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth"
          }
        }
      },
      "options": {
        "graphMode": "area",
        "colorMode": "value",
        "orientation": "horizontal",
        "textMode": "value_and_name"
      }
    },
    {
      "title": "Avg Queries per Org",
      "type": "stat",
      "gridPos": {
        "x": 6,
        "y": 0,
        "w": 6,
        "h": 4
      },
      "description": "Average queries per organization (24h)",
      "targets": [
        {
          "expr": "avg(sum by (organization_id) (rate(business_organization_queries_total[24h]))) * 86400",
          "refId": "A",
          "legendFormat": ""
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth"
          }
        }
      },
      "options": {
        "graphMode": "area",
        "colorMode": "value",
        "orientation": "horizontal",
        "textMode": "value_and_name"
      }
    },
    {
      "title": "Top Organization (Queries)",
      "type": "stat",
      "gridPos": {
        "x": 12,
        "y": 0,
        "w": 6,
        "h": 4
      },
      "description": "Most active organization by query volume",
      "targets": [
        {
          "expr": "topk(1, sum by (organization_id) (rate(business_organization_queries_total[24h]))) * 86400",
          "refId": "A",
          "legendFormat": ""
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth"
          }
        }
      },
      "options": {
        "graphMode": "area",
        "colorMode": "value",
        "orientation": "horizontal",
        "textMode": "value_and_name"
      }
    },
    {
      "title": "Total Org LLM Costs (Today)",
      "type": "stat",
      "gridPos": {
        "x": 18,
        "y": 0,
        "w": 6,
        "h": 4
      },
      "description": "Total LLM costs across all organizations",
      "targets": [
        {
          "expr": "sum(increase(business_organization_llm_cost[24h])) / 100",
          "refId": "A",
          "legendFormat": ""
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "currencyUSD",
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth"
          }
        }
      },
      "options": {
        "graphMode": "area",
        "colorMode": "value",
        "orientation": "horizontal",
        "textMode": "value_and_name"
      }
    },
    {
      "title": "Queries by Organization",
      "type": "timeseries",
      "gridPos": {
        "x": 0,
        "y": 4,
        "w": 12,
        "h": 8
      },
      "description": "Query volume per organization (5-min rate)",
      "targets": [
        {
          "expr": "sum(rate(business_organization_queries_total[5m])) by (organization_id) * 300",
          "refId": "A",
          "legendFormat": ""
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth"
          }
        }
      }
    },
    {
      "title": "LLM Cost by Organization",
      "type": "timeseries",
      "gridPos": {
        "x": 12,
        "y": 4,
        "w": 12,
        "h": 8
      },
      "description": "Hourly LLM costs per organization",
      "targets": [
        {
          "expr": "sum(rate(business_organization_llm_cost[1h])) by (organization_id) * 3600 / 100",
          "refId": "A",
          "legendFormat": ""
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "currencyUSD",
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth"
          }
        }
      }
    },
    {
      "title": "Top 10 Organizations (by Queries)",
      "type": "barchart",
      "gridPos": {
        "x": 0,
        "y": 12,
        "w": 12,
        "h": 8
      },
      "description": "Top 10 most active organizations",
      "targets": [
        {
          "expr": "topk(10, sum by (organization_id) (increase(business_organization_queries_total[24h])))",
          "refId": "A",
          "legendFormat": ""
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth"
          }
        }
      }
    },
    {
      "title": "Top 10 Organizations (by Cost)",
      "type": "barchart",
      "gridPos": {
        "x": 12,
        "y": 12,
        "w": 12,
        "h": 8
      },
      "description": "Top 10 organizations by LLM spend",
      "targets": [
        {
          "expr": "topk(10, sum by (organization_id) (increase(business_organization_llm_cost[24h]))) / 100",
          "refId": "A",
          "legendFormat": ""
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "currencyUSD",
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth"
          }
        }
      }
    }
  ],
  "schemaVersion": 36
}